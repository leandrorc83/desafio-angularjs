<div ng-controller="cursoListaCtrl as ctrl">

<h2>Lista de cursos</h2>

<md-button href="#!/curso/dados">Cadastrar curso</md-button> |
<md-button ng-click="ctrl.getCursosComAlunos()">Gerar pdf</md-button>

<md-table-container>
    <table md-table md-progress="true">
        <thead md-head md-order="query.order" md-on-reorder="listar" md-progress="promise">
        <tr md-row>
            <th width="20%" md-column md-order-by="curso.nome"><span>Título</span></th>
            <th width="40%" md-column>Descrição</th>
            <th width="15%" md-column md-numeric>Carga Horária</th>
            <th width="10%" md-column md-numeric>Valor</th>
            <th width="15%" md-column>Ações</th>
        </tr>
        </thead>
        <tbody md-body>
        <tr md-row ng-repeat="curso in cursos">
            <td md-cell>{{curso.titulo}}</td>
            <td md-cell>{{curso.descricao}}</td>
            <td md-cell>{{curso.carga_horaria}}</td>
            <td md-cell style="white-space: nowrap;">{{curso.valor | currency}}</td>
            <td md-cell style="white-space: nowrap;">
                <a href="#!/curso/dados/{{curso.id}}" style="color:inherit;margin-right:5px;">
                    <md-tooltip md-direction="top">
                        Ver/editar
                    </md-tooltip>
                    <span class="material-icons">edit</span>
                </a>

                <span ng-click="abrirRelacaoAlunos($event, curso)" style="color:inherit;cursor:pointer;">
                    <md-tooltip md-direction="top">
                        Ver/gerenciar alunos
                    </md-tooltip>
                    <span class="material-icons">people</span>
                </span>
            </td>
        </tr>
        </tbody>
    </table>
</md-table-container>

<md-table-pagination md-limit="query.limit" md-limit-options="[5, 10, 15]" md-page="query.page"
                     md-total="{{cursos.length}}" md-on-paginate="listar" md-page-select></md-table-pagination>


<div style="visibility: hidden">
    <div class="md-dialog-container" id="myDialog">
        <md-dialog layout-padding flex="80">
            <h2>Relação de alunos</h2>

            <span>
                <b>Curso:</b> {{cursoSelecionado.titulo}}
            </span>


                <label id="funcionario">Funcionário</label>

                <md-autocomplete
                        md-no-cache="true"
                        md-selected-item="ctrl.selectedItem"
                        md-search-text-change="ctrl.searchTextChange(ctrl.searchText)"
                        md-search-text="ctrl.searchText"
                        md-selected-item-change="ctrl.selectedItemChange(item)"
                        md-items="item in ctrl.pesquisarFuncionario(ctrl.searchText)"
                        md-item-text="item.display"
                        md-min-length="0"
                        placeholder="Digite o nome"
                        input-aria-labelledby="funcionario"
                        md-delay="300"
                        >
                    <md-item-template>
                        <span md-highlight-text="ctrl.searchText" md-highlight-flags="^i">
                            {{item.display}}
                        </span>
                    </md-item-template>
                    <md-not-found>
                        Nenhum funcionário com o nome "{{ctrl.searchText}}" foi encontrado.
                    </md-not-found>
                </md-autocomplete>

                <div>
                    <md-button class="md-raised" ng-click="ctrl.relacionarFuncionarioCurso()">Relacionar</md-button>
                </div>

                <div ng-messages="funcionarioForm.endereco.$error" role="alert">
                    <div ng-message="required">Campo obrigatório.</div>
                </div>

            <md-content>
                <p ng-show="alunosCursoSelecionado.length == 0 && !carregandoAlunos">
                    Nenhum aluno relacionado.
                </p>
                <p ng-show="carregandoAlunos">
                    Carregando alunos...
                </p>

                <ul>
                    <li ng-repeat="aluno in alunosCursoSelecionado">
                        {{aluno.nome}}
                    </li>
                </ul>
            </md-content>

        </md-dialog>
    </div>
</div>

</div>